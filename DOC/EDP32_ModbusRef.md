# EDP32 Modbus RTU Reference

EDP32支持工业标准的MOSBUS RTU协议中的03、04、06功能码，通讯协议设置为MODBUS时，用户可以通过
组态软件设计自己的监控软件。有关MODBUS协议具体定义请参考相关文档，本文档不做赘述。

默认串口参数：`波特率115200、8位数据、1位停止、无校验、无流控`。

本文档基于EDP32固件v20.3.24，其余固件版本仅供参考。

## 输入寄存器

输入寄存器只读，使用04功能码访问，定义见下表：

|  地址  | 功能             | 注释                                    |
|-------:|:-----------------|:----------------------------------------|
| 30001  | Uout输出电压     | 32位有符号，扩大100倍                   |
| 30003  | Iout输出电流     | 32位有符号，扩大1000倍                  |
| 30005  | Uin输入电压      | 32位有符号，扩大100倍                   | 
| 30008  | Tpcb功率板温度   | 16位有符号，扩大10倍                    |
| 30011  | timeSec运行时间  | 32位有符号，单位秒                      |
| 30013  | Ah电量           | 32位有符号，扩大10000倍                 |
| 30015  | Wh电量           | 32位有符号，扩大10000倍                 |
| 30017  | 数据记录计数     | 32位无符号                              |
| 30021  | 序列号0          | 16位无符号                              |
| 30022  | 序列号1          | 16位无符号                              |
| 30023  | 序列号2          | 16位无符号                              |
| 30024  | 序列号3          | 16位无符号                              |
| 30025  | 序列号4          | 16位无符号                              |
| 30026  | 序列号5          | 16位无符号                              |
| 30027  | 固件版本         | 16位无符号，高7位年，中4位月，低5位日   |

查询输出电压输出电流举例如下：

```
查询命令
01 04 00 00 00 04 F1 C9
设备响应
01 04 08 00 00 01 F3 00 00 00 00 21 C9 
```

查询命令起始地址0，数据长度4。查询返回2个32位寄存器数据，分别为0x000001F3和0x00000000，分别表示4.99V和0.000A。

查询序列号举例如下：

```
查询命令
01 04 00 14 00 06 30 0C 
设备响应
01 04 0C 6D 36 31 36 37 35 00 01 41 30 57 41 C7 F5 
```

查询命令起始地址0x14=20，数据长度6。查询返回6个16位寄存器数据，设备序列号为：`6D3631363735000141305741`。

## 保持寄存器

|  地址  | 功能             | 注释                                    |
|-------:|:-----------------|:----------------------------------------|
| 40001  | UIADJ0           | 16位无符号，扩大10000倍                 |
| 40002  | UIADJ1           | 16位无符号，扩大10000倍                 |
| 40003  | UIADJ2           | 16位无符号，扩大10000倍                 |
| 40004  | UIADJ3           | 16位无符号，扩大10000倍                 |
| 40005  | UOADJ0           | 16位无符号，扩大10000倍                 |
| 40006  | UOADJ1           | 16位无符号，扩大10000倍                 |
| 40007  | UOADJ2           | 16位无符号，扩大10000倍                 |
| 40008  | UOADJ3           | 16位无符号，扩大10000倍                 |
| 40011  | IOADJ0           | 16位无符号，扩大10000倍                 |
| 40012  | IOADJ1           | 16位无符号，扩大10000倍                 |
| 40013  | IOADJ2           | 16位无符号，扩大10000倍                 |
| 40014  | IOADJ3           | 16位无符号，扩大10000倍                 |
| 40015  | UIZERO           | 16位无符号                              |
| 40016  | UOZERO           | 16位无符号                              |
| 40017  | IOZERO           | 16位无符号                              |
| 40021  | UVP欠压保护      | 16位无符号，扩大100倍                   |
| 40022  | OVP过压保护      | 16位无符号，扩大100倍                   |
| 40023  | OCP过流保护      | 16位无符号，扩大1000倍                  |
| 40024  | OPP过载保护      | 16位无符号，扩大10倍                    |
| 40025  | OTP过温保护      | 16位无符号，扩大10倍                    |
| 40026  | OAP过Ah保护      | 16位无符号，扩大100倍                   |
| 40027  | OWP过Wh保护      | 16位无符号，扩大10倍                    |
| 40028  | OHP超时保护      | 16位无符号，高8位小时，低8位分钟        |
| 40036  | USET输出电压设定 | 16位无符号，扩大100倍                   |
| 40037  | ISET输出电流设定 | 16位无符号，扩大1000倍                  |
| 40043  | VDD电压设定      | 16位无符号，扩大10000倍                 |
| 40044  | FLUSH刷新条数    | 16位无符号                              |
| 40046  | FUNC寄存器       | 16位无符号，保留                        |
| 40047  | DEV寄存器        | 16位无符号，保留                        |
| 40048  | MODBUS地址       | 16位无符号，保留                        |
| 40049  | LOG寄存器        | 16位无符号，保留                        |
| 40050  | LCD寄存器        | 16位无符号，保留                        |
| 40052  | timeSec运行时间  | 32位有符号，单位秒                      |
| 40056  | devCmd设备命令   | 16位无符号                              |
| 40057  | wParam参数       | 16位无符号                              |
| 40058  | lParam参数       | 32位无符号                              |

**注意：文档未提到的保留地址可能使用，请勿随意写入。**

查询输出电压设定值举例如下：

```
查询命令
01 03 00 23 00 01 75 C0 
设备响应
01 03 02 01 F4 B8 53
```

查询命令起始地址36-1=35=0x23，数据长度1。查询返回1个16位寄存器数据，0x01F4=500，表示5.00V。

设置输出电压6.00V举例如下：

```
设置命令
01 06 00 23 02 58 78 9A 
设备响应
01 06 00 23 02 58 78 9A
```

输出电压寄存器地址为36-1=35=0x23，设定数据为600=0x0258。

## 设备命令

40056地址为设备命令devCmd寄存器，使用06功能码向该地址写入特定的数据可以使设备执行特定的命令。
wParam(40057)和lParam(40058)两个地址为设备命令参数，部分设备命令使用参数，需要先写参数，再写设备命令。

EDP32支持的设备命令见下表：

|  命令  | 功能             | 注释                                    |
|-------:|:-----------------|:----------------------------------------|
| 0x0000 | IDLE             | 无操作                                  |
| 0x0001 | ON               | 开启输出                                |
| 0x0002 | OFF              | 关闭输出                                |
| 0x0003 | CLRPWR           | 清除电量                                |
| 0x0004 | RSTERR           | 复位故障                                |
| 0x0005 | REBOOT           | 重启系统                                |
| 0x0006 | REBOOTD          | 延时重启系统，wParam为延时ms数          |
| 0x0007 | SAVEP            | 保存参数                                |
| 0x0008 | LOADP            | 加载参数                                |
| 0x0009 | RSTP             | 复位参数                                |

通讯举例如下：

- 打开输出发送：`01 06 00 37 00 01 F9 C4`
- 关闭输出发送：`01 06 00 37 00 02 B9 C5`
- 清除电量发送：`01 06 00 37 00 03 78 05`
- 重启系统发送：`01 06 00 37 00 05 F8 07`
